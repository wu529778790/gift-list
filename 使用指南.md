# 📖 电子礼簿系统 - 使用指南

## 🚀 快速开始

### 1. 启动项目
```bash
npm run dev
```

### 2. 访问系统
打开浏览器访问：`http://localhost:3000`

---

## 📝 使用流程

### 第一步：创建事项
1. 首次访问会自动跳转到创建页面
2. 填写以下信息：
   - **事项名称**：例如"张三李四新婚之喜"
   - **开始时间**：活动开始日期和时间
   - **结束时间**：活动结束日期和时间
   - **管理密码**：用于后续修改数据（请牢记！）
   - **界面主题**：
     - 喜庆红：适合婚礼、生日等喜事
     - 肃穆灰：适合白事
   - **记账人**：（可选）例如"王五"
   - **GitHub 同步**：（可选）如需云端同步，请填写 GitHub 配置

3. 点击"创建并进入"

### 第二步：录入礼金
在主界面左侧表单中：
1. **姓名**：来宾姓名
2. **金额**：礼金金额（自动显示中文大写）
3. **收款类型**：现金/微信/支付宝/其他
4. **备注**：（可选）简短说明
5. 点击"确认录入"

### 第三步：查看礼簿
主界面右侧显示传统礼簿格式：
- 3行 × 12列 网格布局
- 竖排文字（模拟纸质礼簿）
- 支持分页（每页12条记录）

### 第四步：导出数据
- **打印/PDF**：直接打印或保存为 PDF
- **导出Excel**：下载 Excel 表格
- **开启副屏**：在新窗口显示实时数据（适合大屏展示）

---

## 🎯 高级功能

### 双屏联动
1. 在主界面点击"开启副屏"
2. 副屏会实时同步最新录入的礼金
3. 适合婚礼现场大屏幕展示

### 云端同步（可选）
1. 创建事项时勾选"启用 GitHub 云端同步"
2. 填写：
   - GitHub 用户名（owner）
   - 仓库名（repo）
   - Personal Access Token（需要 repo 权限）
3. 数据会加密存储在 GitHub 仓库中
4. 可在不同设备间同步数据

### 主题切换
- 喜事：红色主题，喜庆氛围
- 白事：灰色主题，庄重氛围

---

## 🔒 数据安全

### 加密机制
- **AES-256**：所有礼金数据加密存储
- **SHA-256**：管理密码哈希存储
- **客户端加密**：数据在浏览器加密后才存储

### 存储位置
- **localStorage**：默认存储在浏览器本地
- **GitHub**：可选，加密后存储在云端

### 数据恢复
如果浏览器数据丢失：
1. **本地恢复**：检查浏览器备份
2. **云端恢复**：从 GitHub 仓库读取
3. **手动导入**：使用其他设备导出的数据

---

## 📱 响应式设计

### 桌面端 (≥1024px)
- 左侧：录入表单
- 右侧：礼簿展示
- 完整显示所有功能

### 平板端 (768px-1023px)
- 垂直堆叠布局
- 适当调整字体大小

### 移动端 (<768px)
- 单列布局
- 优化触摸操作
- 简化显示内容

---

## 🎨 样式说明

### 主题系统
系统内置两套主题，根据创建事项时的选择自动应用：

**喜庆红 (theme-festive)**
- 主色：深红 (#c00)
- 按钮：亮红 (#dc2626)
- 背景：浅红 (#fff2f2)
- 适合：婚礼、生日、乔迁等

**肃穆灰 (theme-solemn)**
- 主色：深灰 (#374151)
- 按钮：中灰 (#4b5563)
- 背景：浅灰 (#f3f4f6)
- 适合：白事、纪念等

### 礼簿格式
```
┌─────────────────────────────────────────────────────────┐
│  姓　名  │  类型  │        金　额        │ ...          │
│  张　三  │  现金  │  壹仟元整  ¥1000    │              │
│  李　四  │  微信  │  伍佰元整  ¥500     │              │
│  王　五  │  支付宝│  贰佰元整  ¥200     │              │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 常见问题

### Q: 页面在 / 和 /main 之间闪烁？
**A**: 这是路由循环问题，已修复。如果仍出现：
1. 清除浏览器缓存：`Ctrl+Shift+R` (Windows) 或 `Cmd+Shift+R` (Mac)
2. 清除 localStorage 和 sessionStorage
3. 重启开发服务器

### Q: 数据没有保存？
**A**: 检查：
1. 浏览器是否禁用了 localStorage
2. 是否使用了隐私/无痕模式
3. 查看浏览器控制台是否有错误

### Q: 如何切换事项？
**A**:
1. 清除 sessionStorage：`sessionStorage.clear()`
2. 访问 `http://localhost:3000`
3. 重新选择或创建事项

### Q: GitHub 同步失败？
**A**: 检查：
1. Token 是否有 repo 权限
2. 仓库是否存在
3. 网络连接是否正常
4. 查看浏览器控制台错误信息

### Q: 如何测试路由跳转？
**A**: 访问 `http://localhost:3000/test-redirect`，使用测试工具

---

## 🛠️ 开发调试

### 测试页面
访问：`http://localhost:3000/test-redirect`

功能：
- ✅ 查看存储状态
- ✅ 清除所有数据
- ✅ 手动触发跳转
- ✅ 实时日志显示

### 浏览器控制台
```javascript
// 查看事件数据
JSON.parse(localStorage.getItem('giftlist_events') || '[]')

// 查看当前会话
JSON.parse(sessionStorage.getItem('currentEvent') || '{}')

// 查看跳转标记
sessionStorage.getItem('has_redirected')

// 清除所有数据
localStorage.clear()
sessionStorage.clear()
```

---

## 📊 数据结构

### 事件 (Event)
```typescript
{
  id: string,
  name: string,
  startDateTime: string,
  endDateTime: string,
  passwordHash: string,
  theme: 'festive' | 'solemn',
  recorder: string,
  createdAt: string
}
```

### 礼金记录 (GiftRecord)
```typescript
{
  id: string,
  eventId: string,
  encryptedData: string  // AES 加密后的 GiftData
}
```

### 礼金数据 (GiftData)
```typescript
{
  name: string,
  amount: number,
  type: '现金' | '微信' | '支付宝' | '其他',
  remark?: string,
  timestamp: string,
  abolished: boolean
}
```

---

## 💡 最佳实践

1. **密码管理**：使用简单易记但不易被猜到的密码
2. **定期备份**：使用 Excel 导出功能备份数据
3. **多设备同步**：启用 GitHub 同步，支持多设备
4. **现场展示**：使用副屏功能在大屏幕展示
5. **打印准备**：使用 PDF 导出打印纸质版

---

## 🎉 开始使用

现在你已经了解了所有功能，可以开始使用了！

**祝使用愉快！** 🎊

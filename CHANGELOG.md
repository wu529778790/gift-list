# 📝 更新日志

## 🔥 v1.0.3 - 智能语音播报 (2025-12-26)

### ✨ 新增功能

#### 🎙️ 智能语音播报
- **自动播报**：每次录入礼金时自动语音播报确认信息
  - 播报内容：姓名 + 中文大写金额 + 支付类型 + 备注（如有）
  - 示例：`张三，贰仟元整，现金`
  - 示例：`李四，壹仟元整，微信，备注：新婚快乐`

- **全局语音控制**：主界面头部添加语音播报按钮
  - **播报统计**：点击播报当前总人数和总金额
  - **停止播报**：播报中点击可立即停止
  - **状态指示**：实时显示语音状态（就绪/播报中/关闭）

- **操作语音反馈**：
  - ✅ **录入成功**：播报"录入成功"
  - ✅ **修改记录**：播报修改后的信息
  - ✅ **删除记录**：播报删除信息
  - ✅ **错误提示**：播报错误信息

- **表单内语音控制**：
  - 语音状态显示（✅ 语音播报已就绪 / ⚠️ 不支持）
  - 测试功能：可单独测试语音播报
  - 实时控制：可停止当前播报

### 🎯 技术特性

- **零依赖**：使用浏览器原生 Web Speech API
- **智能检测**：自动检测浏览器支持情况
- **优雅降级**：不支持的浏览器自动隐藏相关功能
- **异步执行**：语音播报不阻塞表单提交
- **中文优化**：优先使用中文语音，语速适中（0.9倍）
- **实时状态**：200ms 轮询检测播报状态

### 📁 文件变更

#### 新增
- `src/lib/voice.ts` - 语音播报核心服务
  - `isVoiceSupported()` - 检测浏览器支持
  - `speakText()` - 基础文本播报
  - `speakGiftData()` - 礼金数据播报
  - `speakSuccess()` / `speakError()` - 状态提示
  - `stopVoice()` - 停止播报

- `src/components/ui/VoiceControl.tsx` - 语音控制组件
  - 状态显示
  - 停止按钮
  - 测试功能

#### 修改
- `src/components/business/GiftEntryForm.tsx`
  - 集成语音播报功能
  - 添加语音状态显示
  - 添加测试按钮

- `src/app/main/page.tsx`
  - 添加全局语音控制按钮
  - 集成编辑/删除语音反馈
  - 添加统计播报功能

### 🎯 使用说明

**自动播报（录入时）：**
```
输入：张三，2000元，现金
播报：张三，贰仟元整，现金
```

**手动播报（统计数据）：**
```
点击头部"🔊 播报统计"
播报：当前共15人，总金额贰万元整
```

**操作反馈：**
```
修改：修改成功，王五，伍佰元整，现金
删除：已删除 张三 的记录
成功：录入成功
失败：录入失败，请重试
```

### 🌐 浏览器兼容性

- ✅ **Chrome/Edge**：完全支持
- ✅ **Firefox**：支持
- ✅ **Safari**：支持
- ⚠️ **移动浏览器**：可能需要用户交互后才能播放

### 💡 用户体验提升

- **录入确认**：无需看屏幕，听声音即可确认录入正确
- **防错提醒**：播报错误时立即知晓
- **统计查询**：快速了解当前统计数据
- **无障碍友好**：为视障用户提供便利
- **现场氛围**：增加仪式感和互动性

---

---

## 🔥 v1.1.0 - Excel导出功能 (2025-12-25)

### ✨ 新增功能

#### 📊 Excel导出
- **双工作表导出**：
  - **礼金明细表**：包含序号、姓名、金额、大写金额、支付方式、备注、时间
  - **统计汇总表**：总人数、总金额、各支付方式统计、事件信息、导出时间

- **智能数据处理**：
  - 自动过滤已作废的记录
  - 中文大写金额转换（如：壹仟贰佰叁拾元整）
  - 按支付方式分类统计

- **专业格式**：
  - 表头加粗、灰色背景
  - 单元格居中对齐
  - 自动列宽调整
  - 宋体字体，适合打印

### 📁 文件变更

#### 新增
- `src/lib/backup.ts` - 添加 `exportExcel()` 方法
  - 使用 `xlsx` 库生成Excel文件
  - 支持双工作表结构
  - 自动下载文件

#### 修改
- `src/app/main/page.tsx` - 更新导出按钮功能
  - 调用 `BackupService.exportExcel()`
  - 传递解密后的礼金数据

- `README.md` - 更新功能说明
  - 添加Excel导出特性介绍
  - 更新使用指南

### 🎯 使用方式

在主界面点击 **"导出Excel"** 按钮，即可下载包含以下内容的Excel文件：

```
礼簿_事件名称_20251225.xlsx
├── 礼金明细表
│   ├── 序号 | 姓名 | 金额 | 金额大写 | 支付方式 | 备注 | 录入时间
│   └── 数据行...
└── 统计汇总表
    ├── 总人数：15人
    ├── 总金额：¥25,800.00（贰万伍仟捌佰元整）
    ├── 支付方式统计
    │   ├── 现金：¥12,000（8笔）
    │   ├── 微信：¥8,800（4笔）
    │   └── 支付宝：¥5,000（3笔）
    └── 事件信息
        ├── 事件名称：张三李四婚礼
        ├── 开始时间：2025-12-25
        ├── 结束时间：2025-12-26
        ├── 记账人：王五
        └── 导出时间：2025-12-25
```

### 💡 技术实现

- **依赖**：已集成 `xlsx` (v0.18.5) 库
- **纯前端**：浏览器端生成Excel，无需后端
- **数据安全**：仅导出已解密的有效数据
- **兼容性**：支持所有现代浏览器

### 🐛 修复

- 修复了导出功能占位符提示
- 优化了文件名处理（自动移除特殊字符）

---

## 📚 历史版本

### v1.0.0 - 基础功能 (2025-12-24)

**核心功能：**
- ✅ 事件管理（创建、登录、密码保护）
- ✅ 礼金录入（姓名、金额、支付方式、备注）
- ✅ 数据展示（主屏12列网格）
- ✅ 副屏投影（实时同步、自动翻页）
- ✅ 打印/PDF（横屏A4、竖排格式）
- ✅ 数据备份（JSON导入导出）
- ✅ 数据安全（AES-256加密、本地存储）

**技术栈：**
- React 18 + TypeScript
- Tailwind CSS
- CryptoJS (加密)
- Vite (构建)
- vite-plugin-singlefile (单文件打包)

---

## 🔮 未来计划

- [ ] 数据统计图表（饼图、柱状图）
- [ ] 多语言支持
- [ ] 云端同步（可选）
- [ ] 数据导出为CSV格式
- [ ] 批量导入功能
- [ ] 数据筛选和搜索

---

## 📝 开发说明

### 提交规范
- `feat:` 新功能
- `fix:` 修复bug
- `style:` 样式修改
- `refactor:` 代码重构
- `docs:` 文档更新

### 发布流程
1. 更新版本号
2. 更新 CHANGELOG.md
3. 更新 README.md
4. 构建测试
5. 创建 Git Tag
6. 发布 Release

---

**感谢使用！🎉**
